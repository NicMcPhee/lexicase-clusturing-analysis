---
title: "Clustering Runs 2"
author: "Tom Helmuth"
date: "March 10, 2015"
output: 
  html_document:
    toc: true
---

# Introduction

The goal of this document is to consolidate some of the most useful plots we've made using the clustering and diversity data.

## Setup Code

```{r, message=FALSE}
library('ggplot2')
library('cluster')
library('Hmisc')
library("gridExtra")
library("plyr")

setwd("~/Documents/R/Clustering/lexicase-clusturing-analysis/R_notebooks")

source('../scripts/clustering.R')
```

## Import Data

### Replace Space With Newline

```{r}
data_rswn_lexicase = import_from_error_clustering_and_div("../data/RSWN/lexicase/clustering/")
data_rswn_tourney = import_from_error_clustering_and_div("../data/RSWN/tourney/clustering/")
data_rswn_ifs = import_from_error_clustering_and_div("../data/RSWN/ifs/clustering/")
data_rswn = rbind(data_rswn_lexicase, data_rswn_tourney, data_rswn_ifs)
data_rswn$succeeded = factor(data_rswn$succeeded, levels = c(TRUE, FALSE))
data_rswn$treatment = factor(data_rswn$treatment, levels = c("lexicase", "tourney", "ifs"))
```

### Syllables

```{r}
data_syllables_lexicase = import_from_error_clustering_and_div("../data/syllables/lexicase/clustering/")
data_syllables_tourney = import_from_error_clustering_and_div("../data/syllables/tourney/clustering/")
data_syllables_ifs = import_from_error_clustering_and_div("../data/syllables/ifs/clustering/")
data_syllables = rbind(data_syllables_lexicase, data_syllables_tourney, data_syllables_ifs)
data_syllables$succeeded = factor(data_syllables$succeeded, levels = c(TRUE, FALSE))
data_syllables$treatment = factor(data_syllables$treatment, levels = c("lexicase", "tourney", "ifs"))
```

### String Lengths Backwards

```{r}
data_string_lengths_backwards_lexicase = import_from_error_clustering_and_div("../data/string-lengths-backwards/lexicase/clustering/")
data_string_lengths_backwards_tourney = import_from_error_clustering_and_div("../data/string-lengths-backwards/tourney/clustering/")
#data_string_lengths_backwards_ifs = import_from_error_clustering_and_div("../data/string-lengths-backwards/ifs/clustering/")
data_string_lengths_backwards = rbind(data_string_lengths_backwards_lexicase, data_string_lengths_backwards_tourney)#, data_string_lengths_backwards_ifs)
#data_string_lengths_backwards$succeeded = factor(data_string_lengths_backwards$succeeded, levels = c(TRUE, FALSE))
#data_string_lengths_backwards$treatment = factor(data_string_lengths_backwards$treatment, levels = c("lexicase", "tourney", "ifs"))
```

# Scatterplots of Data

It's often nice to see every point of every run, showing the trends and where densest areas occur.

## RSWN

```{r}
plot_all_diversity_lines_faceted(data_rswn)

plot_all_clusters_lines_faceted(data_rswn)
```

## Syllables

```{r}
plot_all_diversity_lines_faceted(data_syllables)

plot_all_clusters_lines_faceted(data_syllables)
```

## String Lengths Backwards

Only has lexicase data so far.

```{r}
plot_all_diversity_lines_faceted(data_string_lengths_backwards)

plot_all_clusters_lines_faceted(data_string_lengths_backwards)
```


# Plot Medians and Quartiles

## RSWN

```{r}
plot_diversity_medians_and_quartiles(data_rswn)

#add_generational_success_counts_plot(data_rswn, plot_diversity_medians_and_quartiles(data_rswn))

plot_cluster_count_medians_and_quartiles(data_rswn) # + facet_grid(succeeded ~ .)
```

## Syllables

```{r}
plot_diversity_medians_and_quartiles(data_syllables)

#add_generational_success_counts_plot(data_syllables, plot_diversity_medians_and_quartiles(data_syllables))

plot_cluster_count_medians_and_quartiles(data_syllables)
```

## String Lengths Backwards

```{r}
plot_diversity_medians_and_quartiles(data_string_lengths_backwards)

#add_generational_success_counts_plot(data_string_lengths_backwards, plot_diversity_medians_and_quartiles(data_string_lengths_backwards))

plot_cluster_count_medians_and_quartiles(data_string_lengths_backwards)
```


# Scratchpad

```{r}

# Finds the number of successes up to each generation for a particular treatment and maximum generations; It is expected that the data only contains 
get_successes_up_to_each_generation_treatment <- function(data, treat, max_gen){
  success_gens = subset(data, generation == 0 & treatment == treat)$success.generation
  
  successes_before_or_at_each_gen = sapply(seq(0, max_gen),
                                           function(gen) sum(success_gens <= gen, na.rm = TRUE))
  
  result = data.frame(generation = seq(0, max_gen),
                      treatment = rep(treat, max_gen + 1),
                      num.successes = successes_before_or_at_each_gen)
  
  return(result)
}

get_successes_up_to_each_generation <- function(data){
  max_gen = max(data$generation)
  treatments = levels(data$treatment)
  
  result = ldply(treatments,
                 function(treat) get_successes_up_to_each_generation_treatment(data,
                                                                               treat,
                                                                               max_gen))
  
  return(result)
}

```

```{r}
data_BOGUS = import_from_error_clustering_and_div("../data/BOGUS/lexicase/clustering/")

success_counts_BOGUS = get_successes_up_to_each_generation(data_BOGUS)

ggplot(success_counts_BOGUS, aes(x=generation, y=num.successes, color=treatment)) +
  geom_line() +
  ylim(c(0, 5)) +
  theme_bw()
```

```{r}
success_counts_rswn = get_successes_up_to_each_generation(data_rswn)

ggplot(success_counts_rswn, aes(x=generation, y=num.successes, color=treatment)) +
  geom_line() +
  ylim(c(0, 100)) +
  theme_bw()
```

